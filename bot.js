require('dotenv').config();
const TelegramBot = require('node-telegram-bot-api');
const cron = require('node-cron');

// –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
const botToken = process.env.BOT_TOKEN;
const chatId = process.env.CHAT_ID;

if (!botToken) {
    console.error('–û—à–∏–±–∫–∞: BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ñ–∞–π–ª–µ .env');
    process.exit(1);
}

if (!chatId) {
    console.error('–û—à–∏–±–∫–∞: CHAT_ID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ñ–∞–π–ª–µ .env');
    process.exit(1);
}

// –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞
const bot = new TelegramBot(botToken, { polling: true });

// –ú–∞—Å—Å–∏–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
const morningMessages = [
    'üåÖ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å –ø—Ä–∏–Ω–µ—Å–µ—Ç –≤–∞–º –º–Ω–æ–≥–æ —Ä–∞–¥–æ—Å—Ç–∏ –∏ —É—Å–ø–µ—Ö–æ–≤!',
    '‚òÄÔ∏è –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ, –¥—Ä—É–∑—å—è! –ù–æ–≤—ã–π –¥–µ–Ω—å - –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏!',
    'üåû –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ñ–µ–ª–∞—é –≤–∞–º –æ—Ç–ª–∏—á–Ω–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –Ω–∞ –≤–µ—Å—å –¥–µ–Ω—å!',
    'üåÑ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å –∫–æ—Ñ–µ –±—É–¥–µ—Ç –∫—Ä–µ–ø–∫–∏–º, –∞ –¥–µ–Ω—å –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–º!',
    'üåª –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–Ω—å —Å –ø–æ–∑–∏—Ç–∏–≤–æ–º –∏ —É–ª—ã–±–∫–æ–π!',
    'üåà –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å –±—É–¥–µ—Ç —è—Ä–∫–∏–º –∏ –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–º!',
    '‚≠ê –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –í–µ—Ä—å—Ç–µ –≤ —Å–µ–±—è –∏ –∏–¥–∏—Ç–µ –∫ —Å–≤–æ–∏–º —Ü–µ–ª—è–º!',
    'üéØ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ù–æ–≤—ã–π –¥–µ–Ω—å - –Ω–æ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∂–¥—É—Ç –≤–∞—Å!',
    'üçÄ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å —É–¥–∞—á–∞ —Å–æ–ø—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–º –≤–µ—Å—å –¥–µ–Ω—å!',
    'ü•ê –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å –∑–∞–≤—Ç—Ä–∞–∫ –±—É–¥–µ—Ç –≤–∫—É—Å–Ω—ã–º, –∞ –¥–µ–Ω—å ‚Äî –¥–æ–±—Ä—ã–º!',
    'üïäÔ∏è –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –°–ø–æ–∫–æ–π—Å—Ç–≤–∏—è, –≥–∞—Ä–º–æ–Ω–∏–∏ –∏ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ–≥–æ –¥–Ω—è!',
    'üéâ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å –∫–∞–∂–¥–∞—è –º–∏–Ω—É—Ç–∞ —Å–µ–≥–æ–¥–Ω—è –±—É–¥–µ—Ç –Ω–∞–ø–æ–ª–Ω–µ–Ω–∞ —Ä–∞–¥–æ—Å—Ç—å—é!',
    'üíê –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å –Ω–∞ –¥—É—à–µ –±—É–¥–µ—Ç —Å–≤–µ—Ç–ª–æ –∏ –ø—Ä–∏—è—Ç–Ω–æ!',
    'üëã –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ù–∞—á–∏–Ω–∞–π—Ç–µ –¥–µ–Ω—å —Å —É–ª—ã–±–∫–æ–π –∏ –≤–µ—Ä–æ–π –≤ —Å–≤–æ–∏ —Å–∏–ª—ã!',
    'üî• –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ñ–µ–ª–∞—é —ç–Ω–µ—Ä–≥–∏–∏ –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è!',
    '‚òï –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –∫–æ—Ñ–µ –¥–∞—Å—Ç –º–Ω–æ–≥–æ —Å–∏–ª –∏ —Ö–æ—Ä–æ—à–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è!',
    'üå∏ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å –±—É–¥–µ—Ç —Ç–∞–∫–∏–º –∂–µ –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–º, –∫–∞–∫ —Ü–≤–µ—Ç–µ–Ω–∏–µ –≤–µ—Å–Ω–æ–π!',
    'ü¶ã –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å –ª–µ–≥–∫–æ—Å—Ç—å –∏ —Å—á–∞—Å—Ç—å–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—é—Ç –≤–∞—Å —Å–µ–≥–æ–¥–Ω—è!',
    'üëë –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ö–æ—Ä–æ–ª–µ–≤—Å–∫–æ–≥–æ —É—Å–ø–µ—Ö–∞ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤–æ –≤—Å–µ–º!',
    'üí° –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å –≤ –≥–æ–ª–æ–≤–µ –±—É–¥–µ—Ç —Å–≤–µ–∂–æ –∏ –ø–æ—è–≤—è—Ç—Å—è –∫–ª–∞—Å—Å–Ω—ã–µ –∏–¥–µ–∏!',
    'üçé –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ó–¥–æ—Ä–æ–≤—å—è, –±–æ–¥—Ä–æ—Å—Ç–∏ –∏ –æ—Ç–ª–∏—á–Ω–æ–≥–æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è!',
    'üèÜ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü–æ–±–µ–∂–¥–∞–π—Ç–µ –ª—é–±—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–∞–¥—É–π—Ç–µ—Å—å –º–µ–ª–æ—á–∞–º!',
    'üå† –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π —Ä–∞—Å—Å–≤–µ—Ç –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç –Ω–∞ –¥–æ–±—Ä—ã–µ –ø–æ—Å—Ç—É–ø–∫–∏!',
    'üß© –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å –≤—Å–µ –¥–µ–ª–∞ —Å–µ–≥–æ–¥–Ω—è —Å–ª–æ–∂–∞—Ç—Å—è –∫–∞–∫ –ø–∞–∑–ª!',
    'üí´ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å –¥–µ–Ω—å –±—É–¥–µ—Ç –≤–æ–ª—à–µ–±–Ω—ã–º –∏ –∑–∞–ø–æ–º–∏–Ω–∞—é—â–∏–º—Å—è!',
    'üå∫ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å –≤–∞—à–∞ –¥–æ–±—Ä–æ—Ç–∞ –ø—Ä–∏—Ç—è–Ω–µ—Ç —Ç–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–∏—Ö –ª—é–¥–µ–π –∏ —Å–æ–±—ã—Ç–∏—è!',
    'üê¶ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –±—É–¥–µ—Ç –≤–µ—Å—ë–ª—ã–º, –∫–∞–∫ —É –ø–µ–≤—á–∏—Ö –ø—Ç–∏—Ü!',
    'ü•∞ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –º–æ–º–µ–Ω—Ç—ã –ø—Ä–∏–Ω–æ—Å—è—Ç —Ç–æ–ª—å–∫–æ —Ä–∞–¥–æ—Å—Ç—å!',
    'üöÄ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –í–ø–µ—Ä—ë–¥ –∫ —Å–≤–æ–∏–º –º–µ—á—Ç–∞–º –∏ —Ü–µ–ª—è–º!',
    'üìà –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –ü—É—Å—Ç—å –≤—Å–µ –≤–∞—à–∏ –Ω–∞—á–∏–Ω–∞–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è –ø—Ä–∏–Ω–µ—Å—É—Ç –ø–ª–æ–¥—ã!',
];

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
function getRandomMorningMessage() {
    const randomIndex = Math.floor(Math.random() * morningMessages.length);
    return `–¢–ï–°–¢: ${morningMessages[randomIndex]}`;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
async function sendMorningMessage() {
    try {
        const message = getRandomMorningMessage();
        await bot.sendMessage(chatId, message);
        console.log(`–£—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: ${new Date().toLocaleString('ru-RU')}`);
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:', error.message);

        // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º chat_id, –≤—ã–≤–æ–¥–∏–º –ø–æ–¥—Å–∫–∞–∑–∫—É
        if (error.message.includes('chat not found')) {
            console.log('–í–æ–∑–º–æ–∂–Ω–æ, –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π CHAT_ID. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É –∏ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π.');
        }
    }
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∂–¥–æ–µ —É—Ç—Ä–æ –≤ 8:00 '0 0 8 * * *'
// –§–æ—Ä–º–∞—Ç: —Å–µ–∫—É–Ω–¥—ã –º–∏–Ω—É—Ç—ã —á–∞—Å—ã –¥–µ–Ω—å –º–µ—Å—è—Ü –¥–µ–Ω—å_–Ω–µ–¥–µ–ª–∏
// - –ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ –≤ 8:00: '0 0 8 * * *'
// - –ö–∞–∂–¥—ã–µ 15 —Å–µ–∫: '*/15 * * * * *'
//
cron.schedule('*/15 * * * * *', () => {
    console.log('–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ!');
    sendMorningMessage();
}, {
    scheduled: true,
    timezone: "Europe/Moscow" // –£–∫–∞–∂–∏—Ç–µ –≤–∞—à —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
bot.onText(/\/start/, (msg) => {
    const chatId = msg.chat.id;

    bot.sendMessage(chatId, '–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç –¥–ª—è —É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π. –ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ –≤ 8:00 —è –±—É–¥—É –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ –≤ –≥—Ä—É–ø–ø—É!');
    console.log(`–ü–æ–ª—É—á–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ /start –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${msg.from.username || msg.from.first_name}`);
});